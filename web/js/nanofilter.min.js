/*!
 *  nanofilter 0.0.1
 *  http://gordonwoodhull.github.io/nanofilter/
 *  Copyright (c) 2012-2013 AT&T Intellectual Property
 *
 *  Licensed under the Eclipse Public License
 *  https://github.com/gordonwoodhull/nanofilter/blob/master/LICENSE
 */

function nanofilter(a,b,c){function d(c){return"http://"+a+":"+b+"/"+c}function e(a,b){d3.json(d(a),b)}function f(a,b){var c=queue();a.forEach(function(a){c.defer(d3.json,d(a))}),c.await(b)}function g(a){var b=["count"];for(var c in m)if(!a||a.dimension!==c){var d;switch(m[c].type){case"set":d="set("+m[c].target.join(",")+")";break;case"interval":d="interval("+m[c].target.join(",")+")"}b.push('.r("'+c+'",'+d+")")}return a.type&&b.push('.a("'+a.dimension+'",'+a.type+"("+a.args.join(",")+"))"),b.join("")}function h(a){function b(){for(var b=a,c=0;c<arguments.length;++c){if(!b[arguments[c]])return console.log("expected data."+Array.prototype.slice.call(arguments,0,c).join(".")),!1;b=b[arguments[c]]}return!0}b("layers"),b("root","children")}var i,j,k={},l={},m={},n={},o=17,p={};return p.dimension=function(a){function b(c){return l[a]?c instanceof Array?c.map(b):k[a].valnames[c]:c}if(!i)throw new Error("no schema");if(!i.fields.find(function(b){return b.name===a}))throw new Error("field "+a+" not found in schema");return{filter:function(b){if(null!==b)throw new Error("unexpected non-null filter()");return delete m[a],this},filterExact:function(c){return c=b(c),m[a]={type:"set",target:[c]},this},filterMultiple:function(c){return c=b(c),m[a]={type:"set",target:c},this},filterRange:function(c){return c=b(c),m[a]={type:"interval",target:c},this},filterFunction:function(){throw new Error("filter functions not allowed")},dispose:function(){return this.filter(null),this},group:function(){function b(a){return function(){return d.type=a,d.args=Array.prototype.slice.call(arguments,0),this}}var c=o++,d={id:c,dimension:a,values:null};return n[c]=d,{mt_interval_sequence:b("mt_interval_sequence"),dive:b("dive"),dispose:function(){return delete n[c],d.values=null,this},all:function(){return d.values}}}}},p.commit=function(a){var b=Object.keys(n),c=[];for(var d in n)c.push(g(n[d]));f(c,function(d){if(d)throw new Error(d);if(arguments.length!==c.length+1)throw new Error("unexpected number of arguments "+arguments.length);for(var e=1;e<arguments.length;++e){var f=arguments[e],g=b[e-1],i=n[g],k=l[i.dimension];i.values=f.root.children.map(function(a){return{key:k?k(a.path[0]):a.path[0],value:a.val}})}!d&&h(f)&&(j=f),a(d,f)})},e("schema",function(a,b){a?c(a,b):(i=b,i.fields.forEach(function(a){if(k[a.name]=a,/^nc_dim_cat_/.test(a.type)){var b=[];for(var c in a.valnames)b[a.valnames[c]]=c;l[a.name]=function(a){return b[a]}}}),c(a,b))}),p}
//# sourceMappingURL=nanofilter.min.js.map