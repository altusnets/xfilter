{"version":3,"sources":["src/nanofilter.js"],"names":[],"mappings":"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","file":"nanofilter.js","sourcesContent":["function nanofilter(server, port, k) {\n    var _schema, _fields = {}, _xform = {}, _filters = {}, _groups = {}, _data, _group_id = 17;\n    var _start_time, _resolution; // in ms (since epoch for start)\n\n    function query_url(q) {\n        return 'http://' + server + ':' + port + '/' + q;\n    }\n\n    function do_query(q, k) {\n        d3.json(query_url(q), k);\n    }\n\n    function do_queries(qs, k) {\n        var Q = queue();\n        qs.forEach(function(q) {\n            Q.defer(d3.json, query_url(q));\n        });\n        Q.await(k);\n    }\n\n    function build_query(group) {\n        var parts = ['count'];\n        for(var f in _filters) {\n            if(group && group.dimension === f)\n                continue;\n            var filter;\n            switch(_filters[f].type) {\n            case 'set':\n                filter = 'set(' + _filters[f].target.join(',') + ')';\n                break;\n            case 'interval':\n                filter = 'interval(' + _filters[f].target.join(',') + ')';\n                break;\n            }\n            parts.push('.r(\"' + f + '\",' + filter + ')');\n        }\n        if(group.print)\n            parts.push('.' + group.splitter + '(\"' + group.dimension + '\",' + group.print() + ')');\n        return parts.join('');\n    }\n\n    function create_group(dimension) {\n        var _id = _group_id++, _anchor = {id: _id, dimension: dimension, values: null, splitter: 'a'};\n        _groups[_id] = _anchor;\n\n        function arg_printer(name /* ... */) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            return function() {\n                return name + '(' + args.map(JSON.stringify).join(',') + ')';\n            };\n        }\n        return {\n            // native interface\n            mt_interval_sequence: function(start, binwid, len) { // ints\n                _anchor.print = arg_printer('mt_interval_sequence', start, binwid, len);\n                _anchor.splitter = 'r';\n                return this;\n            },\n            dive: function(bins, depth) {\n                _anchor.print = arg_printer('dive', bins, depth);\n                _anchor.splitter = 'a';\n                return this;\n            },\n            // somewhat nicer interface\n            time: function(start, binwid, len) { // Date, ms, number\n                start = start ? start.getTime() : _start_time;\n                binwid = binwid || _resolution;\n                len = len || 10*365;\n                var startb = (start - _start_time)/_resolution,\n                    widb = binwid/_resolution;\n                this.mt_interval_sequence(startb, widb, len);\n                return this;\n            },\n            categorical: function() {\n                this.dive([], 1);\n                return this;\n            },\n            dispose: function() {\n                delete _groups[_id];\n                _anchor.values = null;\n                return this;\n            },\n            all: function() {\n                return _anchor.values;\n            }\n        };\n    }\n\n    var nf = {};\n\n    nf.dimension = function(field) {\n        if(!_schema)\n            throw new Error('no schema');\n        if(!_schema.fields.find(function(f) { return f.name === field; }))\n            throw new Error('field ' + field + ' not found in schema');\n\n        function toValues(v) {\n            if(!_xform[field])\n                return v;\n            if(v instanceof Array)\n                return v.map(toValues);\n            return _xform[field].to(v);\n        }\n\n        return {\n            filter: function(v) {\n                if(v !== null)\n                    throw new Error('unexpected non-null filter()');\n                delete _filters[field];\n                return this;\n            },\n            filterExact: function(val) {\n                val = toValues(val);\n                _filters[field] = {type: 'set', target: [val]};\n                return this;\n            },\n            filterMultiple: function(vals) { // unique to nanocubes\n                vals = toValues(vals);\n                _filters[field] = {type: 'set', target: vals};\n                return this;\n            },\n            filterRange: function(range) {\n                range = toValues(range);\n                _filters[field] = {type: 'interval', target: range};\n                return this;\n            },\n            filterFunction: function() {\n                throw new Error('filter functions not allowed');\n            },\n            dispose: function() {\n                this.filter(null);\n                return this;\n            },\n            group: function() {\n                return create_group(field);\n            }\n        };\n    };\n\n    function validate(data) {\n        function expect() {\n            var d = data;\n            for(var i = 0; i < arguments.length; ++i) {\n                if(!d[arguments[i]]) {\n                    console.log('expected data.' + Array.prototype.slice.call(arguments, 0, i).join('.'));\n                    return false;\n                }\n                d = d[arguments[i]];\n            }\n            return true;\n        }\n        expect('layers');\n        expect('root', 'children');\n    }\n\n    function key_ascending(a, b) { // adapted from d3.ascending\n        return a.key < b.key ? -1 : a.key > b.key ? 1 : a.key >= b.key ? 0 : NaN;\n    }\n\n    function ms_mult(suffix) {\n        var mult = 1;\n        switch(suffix) {\n        case 'w': mult *= 7;\n        case 'd': mult *= 24;\n        case 'h': mult *= 60;\n        case 'm': mult *= 60;\n        case 's': return mult*1000;\n        default: return NaN;\n        }\n    }\n\n    nf.commit = function(k) {\n        var ids = Object.keys(_groups), qs = [];\n        for(var id in _groups)\n            qs.push(build_query(_groups[id]));\n        do_queries(qs, function(error) {\n            if(error)\n                throw new Error(error);\n            if(arguments.length !== qs.length + 1)\n                throw new Error('unexpected number of arguments ' + arguments.length);\n\n            for(var i = 1; i < arguments.length; ++i) {\n                var result = arguments[i],\n                    id = ids[i-1],\n                    group = _groups[id],\n                    xform = _xform[group.dimension];\n                group.values = result.root.children.map(function(pv) {\n                    return {key: pv.path[0], value: pv.val};\n                })\n                    .sort(key_ascending)\n                    .map(function(kv) {\n                        return {key: xform ? xform.fro(kv.key) : kv.key, value: kv.value};\n                    });\n            }\n            if(!error && validate(result))\n                _data = result;\n            k(error, result);\n        });\n    };\n\n    do_query('schema', function(error, schema) {\n        if(error)\n            k(error, schema);\n        else {\n            _schema = schema;\n            _schema.fields.forEach(function(f) {\n                _fields[f.name] = f;\n                if(/^nc_dim_cat_/.test(f.type)) {\n                    var vn = [];\n                    for(var vname in f.valnames)\n                        vn[f.valnames[vname]] = vname;\n                    _xform[f.name] = {\n                        to: function(v) {\n                            return f.valnames[v];\n                        },\n                        fro: function(v) {\n                            return vn[v];\n                        }\n                    };\n                }\n                else if(/^nc_dim_time_/.test(f.type)) {\n                    _xform[f.name] = {\n                        to: function(v) {\n                            return Math.round((v.getTime() - _start_time)/_resolution);\n                        },\n                        fro: function(v) {\n                            return new Date(_start_time + v * _resolution);\n                        }\n                    };\n                }\n            });\n            _schema.metadata.forEach(function(m) {\n                if(m.key === 'tbin') {\n                    var parts = m.value.split('_');\n                    _start_time = Date.parse(parts[0] + ' ' + parts[1]);\n                    var match;\n                    if((match = /^([0-9]+)([a-z]+)$/.exec(parts[2]))) {\n                        var mult = ms_mult(match[2]);\n                        _resolution = +match[1] * mult;\n                    }\n                }\n            });\n            k(error, schema);\n        }\n    });\n\n    return nf;\n}\n"]}